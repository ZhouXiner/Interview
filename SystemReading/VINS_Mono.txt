1.概述：
紧耦合VIO系统，前端提Harris角点，然后光流法找到匹配
IMU的估计值为Tracking提供良好的初始值，然后利用一个prior+IMU+视觉的非线性优化
优化得到位姿和点信息，再进行回环检测并优化

2.IMU的估计
欧拉法、中值法等等能够得到当前的PVQ和PVQ增量的具体数据
并且可以联合考虑到当前IMU数据的信息矩阵，来确定其在非线性优化中的权重
这里有几点需要注意：
1.我们根据力学构造了PVQ的连续形式，然后我们为了避免优化位姿后需要更新预积分，所以处理了原式，使得预积分
  可以单独进行，并将其设置为了增量部分
2.增量部分随着时间推移，一直在增长(两帧之间很多个IMU数据，不断累积)，这个我们称之为bias(可以通过线性)
  方式进行更新；这就意味着我们有两种方式得到这个增量(a.不断累计 2.直接根据力学得到两帧之间的增量)
  这也是后面IMU优化的error
3.我们根据IMU得到的bias，是存在误差的，因此我们会利用迭代的方式计算两帧之间的IMU数据的Jacobian和信息
  矩阵，并且引入真实值、理想值、误差值这种概念，用来计算得到增量的误差的导数

3.后端优化
后端优化分为了三部分，先验信息+IMU+视觉
状态向量包括三部分：相机信息(p,v,q,ba,bw),点信息(逆深度)，body系与camera系之间的外参(pbc,qbc)

IMU约束
IMU的误差由  中值法得到的增量-bias得到的增量，注意到这里得到的实际上就是增量的误差！因此我们在之前求
的IMU的误差有了用武之地！
这里优化的量是两帧的(p,v,q,ba,bw)

视觉约束
视觉约束比较简单，就是一个重投影误差，优化的变量有两帧的(p,q),逆深度还有body与camera之间的外参

4.初始化
我们已经构造好了误差项和优化变量，采用松耦合的方式
首先利用sfm求出窗口内的帧的位姿和路标的3d位置
再将IMU数据和视觉数据对齐，优化变量有：
重力方向、尺度因子、陀螺仪的误差和每一帧的速度

sfm
首先根据基础矩阵得到参考帧（共视关系最好）与当前帧之间的pose
然后（1-参考）和（参考-当前帧）两部分分别利用pnp解pose(某一帧到参考帧,某一帧到当前帧),三角化点
注意这里三角化，一对匹配，四个约束能够求出3维点，直接用的svd解
然后将得到的pose当做初始值，利用cv::solvepnp将之前得到的3d-2d match进一步优化位姿，此时我们获得了
比较好的初始化位姿

初始化对齐
陀螺仪bias矫正:视觉得到的旋转和IMU的旋转应该一样，这样就可以得到误差了
速度、尺度和重力优化：和IMU误差类似，将IMU预积分得到的增量和预测得到的增量求一个误差，可以优化
进一步的，重力优化得到的是gc0，我们想要将c0和w对齐，所以进一步的纠正重力，将g0对齐到z轴

5.回环检测
两部分：1.检测到回环，就将回环帧和候选帧建立约束，一起优化位姿（快速重定位）
　　　　2.构建一个4DoF的优化向量，将数据库里所有的位姿优化，pitch和roll角
　　　　　是不需要优化的，因为重力向量就将这两个角确定了
（单目SLAM系统有7自由度不可观：6自由度姿态+尺度。
　单目+IMU系统有4自由度不可观：yaw角+3自由度位置不可观。
　roll和pitch由于重力的存在而可观，尺度因子由于加速度计的存在而可观。）

6.后端优化中，都需要乘上rot_diff,因为yaw角不可观（这个是被证明的，关于SLAM的不可观测），
　所以优化后还要再回到最开始优化的位置，关于不可观测的问题，可以看
　https://blog.csdn.net/fb_941219/article/details/100279527
Finally，we are reviewing the MSCKF
It's really not a good day
MSCKF在EKF框架下，结合了IMU和视觉信息，能够适应一段时间内的纹理缺失和剧烈运动
因为传统的EKF框架会把所有的特征点都放入状态向量进行估计，导致维度爆炸，而MSCKF利用特征点作为了帧
与帧之间的约束，只计算帧的位姿，而且会定期删除一些帧，所以维度不会爆炸

MSCKF利用特征点之间的三角化，来进行重投影误差，采用了当点丢失才三角化的方式，而不是传统的将点放入
优化向量的方式，这样三角化稳定性高，能够用

和EKF一样，MSCKF的核心就在于维护一个协方差矩阵，MSCKF分为以下几步：
IMU积分、相机状态扩增、特征点三角化、特征更新、历史相机状态更新
首先，是一个初始化的协方差矩阵和状态向量
根据IMU积分，更新
加入相机状态，增广状态向量和协方差矩阵
根据三角化信息，更新状态向量和协方差矩阵(所以一开始只有一个相机位姿的时候，就不更新)
然后再继续IMU积分，更新
继续加入相机状态并Update
当相机姿态过多时，就将最老的相机状态删除

特征前端跟踪：
MSCKF采用了双目，前后帧之间根据左相机tracking，帧内部左右相机进行追踪，然后根据2-pointsRANSAC
进行筛选。首先左相机提点，然后跟右相机进行LK光流追踪，将成功的点再和前后帧进行tracking,然后后一帧
在没有点的地方进行新的提点，继续上述操作，这样每一帧的点有两部分1.前一帧trakcing  2.自己提点
注意，提的点都是左右相机成对出现的，前后帧之间根据IMU数据当初始值，左右相机根据极线约束
IMU数据：根据时间戳选取数据，然后计算平均角速度，得到旋转
如何进行tracking:根据LK光流进行筛选，然后极线约束进一步筛选
2-pointsRANSAC:根据极线约束计算出平移(旋转由IMU得到)，然后进行RANSAC,首先需要确认是不是纯旋转
即如果根据纯旋转的重投影误差很小，就说明纯旋转

IMU积分：
积分需要对两部分进行预测：IMU状态向量的p,v,q和协方差矩阵
p,v,q可以根据欧拉、中值等方法预测，协方差则需要先求出IMU误差状态的运动模型，即Ximu' = FXimu+G，
注意,这里的Ximu表示的是误差状态向量，得到了误差状态和误差导数之间的关系
这样前一个状态和后一个状态的关系就得到。注意，状态向量直接更新的是状态，而协方差则是根据误差向量
进行更新的，为什么能够根据误差项来更新状态向量的协方差呢，可以将这个式子改掉(参考VINS_Mono的推导书)
能够发现这个式子表示的是上一个时刻的误差与下一个时刻的误差之间成线性关系，进一步就可以用上一个时刻
的状态描述下一个状态

增广：
状态向量的增广：相机的状态可以根据当前的IMU状态得到(Tbc,将两者联系起来)
协方差矩阵的增广：我们有的式子是状态量之间的关系，现在需要找到的是误差量之间的关系，将真实值拆分成
               误差值+测量值，然后找到误差值之间的关系
解释一下J：核心是camera系下位姿的变化和IMU的误差状态向量、Camera的误差状态向量的关系

更新：
更新的前提就是有特征点被丢失了测量数据，我们此时将其三角化，构建其观测帧之间的重投影误差
重投影误差需要考虑的状态向量有两部分：1.Camera的状态  2.特征点参数
等构造好后，利用SVD构造零空间，找到残差和Camera状态之间的关系，更新状态向量，再根据EKF公式
更新协方差矩阵

